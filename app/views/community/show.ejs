<div class="d-flex">
  <div class="sidebar">
    <div class="profile">
      <img src="/img/profiles/<%= user.picture %>" alt="Profile" />
      <h6 class="fw-bold d-inline-block"><%= user.name %></h6>
    </div>
    <ul class="list-group menu mt-4">
      <a href="/my" class="list-group-item list-group-item-action border-0 p-2">
        <img src="/img/icons/dashboard.png" />
        <h6 class="d-inline-block text-secondary">Dashboard</h6>
      </a>
      <a
        href="/my/course"
        class="list-group-item list-group-item-action border-0 p-2"
      >
        <img src="/img/icons/course.png" />
        <h6 class="d-inline-block text-secondary">Course</h6>
      </a>
      <a
        href="/my/quiz"
        class="list-group-item list-group-item-action border-0 p-2"
      >
        <img src="/img/icons/quiz.png" />
        <h6 class="d-inline-block text-secondary">Quiz</h6>
      </a>
      <a
        href="/my/community"
        class="list-group-item list-group-item-action border-0 p-2 active"
      >
        <img src="/img/icons/community.png" />
        <h6 class="d-inline-block text-secondary">Community</h6>
      </a>
    </ul>
  </div>
  <div class="community">
    <div class="chat-container">
      <% chats.forEach(chat => { const userType = chat.user === user.username ?
      'sender' : 'receiver'; const align = userType === 'sender' ? 'end' :
      'start'; const date = new Date(chat.chat_date); %>
      <div class="row text-dark justify-content-<%= `${align} ${userType}` %>">
        <div
          class="col-1 <%= userType === 'receiver' ? 'order-1 text-end' : 'order-2 text-start' %>"
        >
          <img
            src="/img/profiles/<%= chat.User.picture %>"
            class="rounded-circle mt-4"
            style="width: 32px; height: 32px"
          />
        </div>
        <div
          class="col <%= userType === 'receiver' ? 'order-2' : 'order-1' %> chat rounded position-relative my-2 p-3 text-<%= align %>"
        >
          <span class="fw-bold"><%= chat.name %></span>
          <p class="mt-2"><%= chat.chat %></p>
          <span class="chat-date">
            <%= `${date.getDate()}/${date.getMonth()+1}/${date.getFullYear()} |
            ${(""+date.getHours()).length === 1 ? '0' + date.getHours() :
            date.getHours()}:${(""+date.getMinutes()).length === 1 ? '0' +
            date.getMinutes() : date.getMinutes()}` %>
          </span>
        </div>
      </div>
      <% }) %>
    </div>
    <div class="send-container p-3">
      <form action="/community/<%= community.id%>" method="POST">
        <div class="row justify-content-center">
          <div class="col-9 p-0">
            <div class="shadow">
              <input
                type="text"
                class="form-control"
                placeholder="Write your chat here..."
                name="chat"
                autocomplete="off"
                autofocus
              />
            </div>
          </div>
          <div class="col-1 p-0 text-center shadow button-container">
            <button type="submit" class="btn btn-send w-100 h-100">
              <img src="/img/icons/send.svg" alt="Send" />
            </button>
          </div>
        </div>
        <input type="hidden" name="username" value="<%= user.username %>" />
        <input type="hidden" name="name" value="<%= user.name %>" />
        <input type="hidden" name="picture" value="<%= user.picture %>" />
        <input type="hidden" name="community" value="<%= community.id %>" />
      </form>
    </div>
  </div>
  <div class="member-sidebar">
    <h5 class="text-center text-uppercase"><%= community.name %></h5>
    <hr />
    <h6 class="text-uppercase mt-4">instructor</h6>
    <ul class="list-group">
      <button
        type="button"
        class="list-group-item list-group-item-action btn-detail-profile text-secondary instructor border-0"
        data-bs-toggle="modal"
        data-bs-target="#detailProfile"
      >
        <span class="position-relative d-inline-block">
          <img
            src="/img/profiles/<%= instructor.picture %>"
            class="rounded-circle"
            style="width: 30px; height: 30px"
          />
          <span
            class="user-status position-absolute p-2 bg-danger border border-light rounded-circle"
          >
            <span class="visually-hidden"><%= instructor.username %></span>
          </span>
        </span>
        <span class="name">
          <%= `${instructor.name}${isInstructor ? ' (Me)' : ''}` %>
        </span>
      </button>
    </ul>
    <h6 class="text-uppercase mt-4">members (<%= course.members %>)</h6>
    <ul class="list-group members">
      <% if(!isInstructor){ %>
      <button
        type="button"
        class="list-group-item list-group-item-action btn-detail-profile text-secondary member border-0 me"
        data-bs-toggle="modal"
        data-bs-target="#detailProfile"
      >
        <span class="position-relative d-inline-block">
          <img
            src="/img/profiles/<%= user.picture %>"
            class="rounded-circle"
            style="width: 30px; height: 30px"
          />
          <span
            class="user-status position-absolute p-2 bg-danger border border-light rounded-circle"
          >
            <span class="visually-hidden"><%= user.username %></span>
          </span>
        </span>
        <span class="name"> <%= user.name %> (Me) </span>
      </button>
      <% } communityUsers.forEach(communityUser => { %>
      <button
        type="button"
        class="list-group-item list-group-item-action btn-detail-profile text-secondary member border-0"
        data-bs-toggle="modal"
        data-bs-target="#detailProfile"
      >
        <span class="position-relative d-inline-block">
          <img
            src="/img/profiles/<%= communityUser.User.picture %>"
            class="rounded-circle"
            style="width: 30px; height: 30px"
          />
          <span
            class="user-status position-absolute p-2 bg-danger border border-light rounded-circle"
          >
            <span class="visually-hidden"
              ><%= communityUser.User.username %></span
            >
          </span>
        </span>
        <span class="name"> <%= communityUser.User.name %> </span>
      </button>
      <% }) %>
    </ul>
  </div>
</div>

<!-- Detail Profile -->
<div
  class="modal fade"
  id="detailProfile"
  tabindex="-1"
  aria-labelledby="detailProfileLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="detailProfileLabel">User Detail</h1>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body text-center">
        <img
          src=""
          alt=""
          class="detail-picture"
          style="width: 300px; height: 300px"
        />
        <h3 class="detail-name mt-3"></h3>
        <span class="fs-5 text-secondary detail-username"></span>
      </div>
    </div>
  </div>
</div>
